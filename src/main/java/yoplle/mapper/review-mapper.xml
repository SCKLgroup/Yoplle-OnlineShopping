<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yoplle.vo">
	<!-- 문의 -->
	<select id="getFaqSequence" resultType="Integer">
		SELECT FAQ_SEQ.NEXTVAL FROM DUAL
	</select>
	
	<select id="selectFaqList" parameterType="int" resultType="faqlist"> <!-- 문의 리스트 -->
		<!-- select * from userinfo u, (SELECT faqset.FAQ_NO, faqset.ITEM_NO, faqset.user_no, faqset.FAQ_TITLE, faqset.FAQ_CONTENT, faqset.FAQ_IMG, faqset.FAQ_PW, faqset.FAQ_DATE, faqset.ANS_CONTENT, faqset.ANS_DATE FROM
(SELECT FAQ.FAQ_NO, FAQ.ITEM_NO, FAQ.USER_NO, FAQ.FAQ_TITLE, FAQ.FAQ_CONTENT, FAQ.FAQ_IMG, FAQ.FAQ_PW, FAQ.FAQ_DATE, FAQ_ANS.ANS_CONTENT, FAQ_ANS.ANS_DATE
FROM FAQ, FAQ_ANS WHERE faq.faq_no = faq_ans.faq_no(+)) faqset where faqset.item_no=#{no}) a where a.user_no=u.user_no -->
select * from userinfo u, 
(select b.FAQ_NO, b.ITEM_NO, b.USER_NO, b.FAQ_TITLE, b.FAQ_CONTENT, b.FAQ_IMG, b.FAQ_PW, b.FAQ_DATE, fs.EMP_NO, fs.ANS_CONTENT, fs.ANS_DATE
from faq_ans fs right outer join (select * from faq where item_no=#{no}) b on fs.faq_no=b.faq_no) i where u.user_no=i.user_no
	</select>

	<insert id="insertFaqList" parameterType="faqlist"> <!-- 문의 입력 -->
		INSERT INTO FAQ(faq_no, item_no, user_no, faq_title, faq_content, faq_img, faq_pw, faq_date)
		VALUES(#{faq_no}, #{item_no}, #{user_no}, #{faq_title}, #{faq_content}, #{faq_img}, #{faq_pw}, SYSDATE)
	</insert>

	
	<!-- 리뷰 -->
	<select id="getReviewSequence" resultType="Integer">
		SELECT REVIEW_SEQ.NEXTVAL FROM DUAL
	</select>
	
	<select id="selectReview" parameterType="int" resultType="yoplle.vo.ReviewVO"> <!-- review 리스트 출력 -->
		select r.review_no, r.or_de_no, r.review_title, r.review_content, r.review_date, o.user_id from review r, (select * from userinfo u, 
		(select b.or_de_no, a.user_no from orderinfo a, (select or_de_no, order_no, item_no from order_de where item_no=#{no}) b where a.order_no=b.order_no)
		k where u.user_no=k.user_no) o where r.or_de_no=o.or_de_no
	</select>
	
	<insert id="insertReview" parameterType="yoplle.vo.ReviewVO"> <!-- 작성한 데이터 리뷰 테이블로 삽입 -->
		INSERT INTO REVIEW values(#{review_no}, #{or_de_no}, #{review_title}, #{review_content}, #{review_hit}, sysdate)
	</insert>
	
	<select id="checkOrderUser" parameterType="hashMap" resultType="int"> <!-- 리뷰 작성 전 구매했는지 아이디로 체크 -->
		SELECT count(*)
		FROM ORDERINFO A, ORDER_DE B, USERINFO C 
		WHERE A.ORDER_NO=B.ORDER_NO AND C.USER_NO=A.USER_NO AND B.ITEM_NO=#{no} and c.user_id=#{id};
	</select>
	
	


</mapper>
